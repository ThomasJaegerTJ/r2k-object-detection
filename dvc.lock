schema: '2.0'
stages:
  generate_csv:
    cmd: python src/generate_csv.py --csv_dir=data/datasets/raw/ImageTagger --output_dir=data/datasets/ImageTagger/labels
    deps:
    - path: data/datasets/raw/ImageTagger
      md5: 0136ea4c8f0508aabd8a00a1d21e4e4d.dir
      size: 19162825290
      nfiles: 26990
    - path: src/generate_csv.py
      md5: f4ac5c66c6c0dcac45eb31410b070dc9
      size: 2776
    outs:
    - path: data/datasets/ImageTagger/labels
      md5: cbf4b2db22b29fca4703750020436266.dir
      size: 3893629
      nfiles: 29
  generate_tfrecord:
    cmd: python src/generate_tfrecord.py --output_dir=data/datasets/ImageTagger/records
      --images_dir=data/datasets/raw/ImageTagger --csv_dir=data/datasets/ImageTagger/labels
      --info_path=data/datasets/ImageTagger/info.json
    deps:
    - path: data/datasets/ImageTagger/labels
      md5: f373fb62902bf4242bd26657aaee40b0.dir
      size: 1123069
      nfiles: 11
    - path: data/datasets/raw/ImageTagger
      md5: 0136ea4c8f0508aabd8a00a1d21e4e4d.dir
      size: 19162825290
      nfiles: 26990
    - path: src/generate_tfrecord.py
      md5: bec15d3f995fe0628e338afdd73e0feb
      size: 6346
    params:
      params.yaml:
        dataset.image.channels: 1
        dataset.image.height: 120
        dataset.image.width: 160
        dataset.nr_records: 20
        dataset.test_split: 0.2
    outs:
    - path: data/datasets/ImageTagger/info.json
      md5: 2ae9c0e73ac02f5c23d63a192d484c85
      size: 72
    - path: data/datasets/ImageTagger/records
      md5: 2a35a7b79cda3f61a5d447c8cceadcd6.dir
      size: 69272946
      nfiles: 20
  train:
    cmd: python src/train.py --tfrecord_dir=data/datasets/ImageTagger/records/train
      --tfrecord_test_dir=data/datasets/ImageTagger/records/test --output_dir=data/models/experimodel
      --history_path=data/metrics/history.csv --dataset_info_path=data/datasets/ImageTagger/info.json
    deps:
    - path: data/datasets/ImageTagger/info.json
      md5: 2ae9c0e73ac02f5c23d63a192d484c85
      size: 72
    - path: data/datasets/ImageTagger/records
      md5: 2a35a7b79cda3f61a5d447c8cceadcd6.dir
      size: 69272946
      nfiles: 20
    - path: src/train.py
      md5: f9d9ee9e8ad2272284f3a26e3c38b95c
      size: 5840
    params:
      params.yaml:
        dataset.val_split: 0.1
        model.layers:
        - - 1
          - 16
        - - 2
          - 24
        - - 3
          - 24
        - - 4
          - 24
        - - 4
          - 24
        train.batch_size: 16
        train.early_stopping: true
        train.epochs: 20
        train.lr: 0.01
    outs:
    - path: data/metrics/history.csv
      md5: bbb18e543c5d17be7d7446e6149b7994
      size: 844
    - path: data/models/experimodel
      md5: 06864f6d9d4a96bc014045abb6d270b0.dir
      size: 3843466
      nfiles: 4
  evaluate:
    cmd: python src/evaluate.py --model_path=data/models/experimodel/experimodel.hdf5
      --testset_dir=data/datasets/ImageTagger/records/test --scores_path=data/metrics/scores.json
      --dataset_info_path=data/datasets/ImageTagger/info.json
    deps:
    - path: data/datasets/ImageTagger/info.json
      md5: 2ae9c0e73ac02f5c23d63a192d484c85
      size: 72
    - path: data/datasets/ImageTagger/records/test
      md5: 464f43cc203e4dff111b3be7e5073d42.dir
      size: 13741673
      nfiles: 4
    - path: data/models/experimodel
      md5: 06864f6d9d4a96bc014045abb6d270b0.dir
      size: 3843466
      nfiles: 4
    - path: src/evaluate.py
      md5: 6098875adfcf03f8cab6a651634b5122
      size: 4984
    outs:
    - path: data/metrics/scores.json
      md5: 2b6136ea800f1318e78b400694b815d6
      size: 618
