schema: '2.0'
stages:
  generate_csv:
    cmd: python src/generate_csv.py --csv_dir=data/datasets/raw/ImageTagger --output_dir=data/datasets/ImageTagger/labels
    deps:
    - path: data/datasets/raw/ImageTagger
      md5: 0136ea4c8f0508aabd8a00a1d21e4e4d.dir
      size: 19162825290
      nfiles: 26990
    - path: src/generate_csv.py
      md5: f4ac5c66c6c0dcac45eb31410b070dc9
      size: 2776
    outs:
    - path: data/datasets/ImageTagger/labels
      md5: cbf4b2db22b29fca4703750020436266.dir
      size: 3893629
      nfiles: 29
  generate_tfrecord:
    cmd: python src/generate_tfrecord.py --output_dir=data/datasets/ImageTagger/records
      --images_dir=data/datasets/raw/ImageTagger --csv_dir=data/datasets/ImageTagger/labels
      --info_path=data/datasets/ImageTagger/info.json
    deps:
    - path: data/datasets/ImageTagger/labels
      md5: cbf4b2db22b29fca4703750020436266.dir
      size: 3893629
      nfiles: 29
    - path: data/datasets/raw/ImageTagger
      md5: 0136ea4c8f0508aabd8a00a1d21e4e4d.dir
      size: 19162825290
      nfiles: 26990
    - path: src/generate_tfrecord.py
      md5: bec15d3f995fe0628e338afdd73e0feb
      size: 6346
    params:
      params.yaml:
        dataset.image.channels: 1
        dataset.image.height: 120
        dataset.image.width: 160
        dataset.nr_records: 20
        dataset.test_split: 0.2
    outs:
    - path: data/datasets/ImageTagger/info.json
      md5: 4893e09a38c861796343021aa3182d43
      size: 73
    - path: data/datasets/ImageTagger/records
      md5: e0749aab2bc961ce5966cd082673a7f1.dir
      size: 216767388
      nfiles: 20
  train:
    cmd: python src/train.py --tfrecord_dir=data/datasets/ImageTagger/records/train
      --tfrecord_test_dir=data/datasets/ImageTagger/records/test --output_dir=data/models/experimodel
      --history_path=data/metrics/history.csv --dataset_info_path=data/datasets/ImageTagger/info.json
    deps:
    - path: data/datasets/ImageTagger/info.json
      md5: 2ae9c0e73ac02f5c23d63a192d484c85
      size: 72
    - path: data/datasets/ImageTagger/records
      md5: 7e3eb253b1dd1ba283950894b9cf6ac3.dir
      size: 69272946
      nfiles: 20
    - path: src/train.py
      md5: a7272c7cce28afe7a6b7f610d20d905c
      size: 5466
    params:
      params.yaml:
        dataset.val_split: 0.1
        model.layers:
        - - 1
          - 16
        - - 2
          - 24
        - - 3
          - 24
        - - 4
          - 24
        - - 4
          - 24
        train.batch_size: 16
        train.early_stopping: true
        train.epochs: 200
        train.lr: 0.01
    outs:
    - path: data/metrics/history.csv
      md5: 5d235dd5760dae8139631d2f850a4e8a
      size: 8659
    - path: data/models/experimodel
      md5: 1a2f6cb38df5e01563a2675ef9c88879.dir
      size: 3985000
      nfiles: 5
  evaluate:
    cmd: python src/evaluate.py --model_path=data/models/experimodel/experimodel.hdf5
      --testset_dir=data/datasets/ImageTagger/records/test --scores_path=data/metrics/scores.json
      --dataset_info_path=data/datasets/ImageTagger/info.json
    deps:
    - path: data/datasets/ImageTagger/info.json
      md5: 2ae9c0e73ac02f5c23d63a192d484c85
      size: 72
    - path: data/datasets/ImageTagger/records/test
      md5: 18343b10e94e0ba08057de40861df479.dir
      size: 13839625
      nfiles: 4
    - path: data/models/experimodel
      md5: 1a2f6cb38df5e01563a2675ef9c88879.dir
      size: 3985000
      nfiles: 5
    - path: src/evaluate.py
      md5: e73ba99db3e9d6e6ad8a26935ef16488
      size: 4392
    outs:
    - path: data/metrics/scores.json
      md5: a37525304cc937f814b202ac5cc500aa
      size: 613
